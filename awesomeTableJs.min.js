!function(e,t){"function"==typeof define&&define.amd?define(["awesomeTableJs"],t):e.awesomeTableJs=t(e.awesomeTableJs)}(this,function(){function e(e){this.globalOptions={url:"",data:"",pageSize:15,tableWrapper:"",paginationWrapper:"",searchboxWrapper:"",pageSizeWrapper:"",buildSearch:!0,buildPagination:!0,buildPageSize:!0,buildSorting:!0,columnsTypes:""};for(var t in this.globalOptions)e.hasOwnProperty(t)&&(this.globalOptions[t]=e[t]);if(this.globalOptions.tableWrapper&&(this.tableWrapper=document.querySelector(this.globalOptions.tableWrapper)),this.globalOptions.searchboxWrapper&&(this.searchboxWrapper=document.querySelector(this.globalOptions.searchboxWrapper)),this.globalOptions.paginationWrapper&&(this.paginationWrapper=document.querySelector(this.globalOptions.paginationWrapper)),this.globalOptions.pageSizeWrapper&&(this.pageSizeWrapper=document.querySelector(this.globalOptions.pageSizeWrapper)),this.tableWrapper){var a=p("table",{className:"aweTbl-table"});this.tableElement=a,this.tableWrapper.appendChild(a)}else{var s=p(null,{className:"aweTbl-table-wrapper"}),a=p("table",{className:"aweTbl-table"});this.tableElement=a,s.appendChild(a),document.body.appendChild(s)}if(!this.paginationWrapper){var s=p(null,{className:"aweTbl-pagination-wrapper"});this.paginationWrapper=s,document.body.appendChild(s)}if(!this.pageSizeWrapper){var s=p(null,{className:"aweTbl-pageCount-wrapper"});this.pageSizeWrapper=s,document.body.appendChild(s)}if(!this.searchboxWrapper){var s=p(null,{className:"aweTbl-searchBox-wrapper"});this.searchboxWrapper=s,document.body.appendChild(s)}this.isFiltered=!1,this.typingCount=null,this.jsonKeys=[]}function t(e){console.log(JSON.stringify("start saveing filtered array")),this.typingTimer=setTimeout(function(){sessionStorage.awesomeTableFiltereddata=JSON.stringify(e)},1e3)}function a(e){switch(typeof e){case"object":if(!Array.isArray(e))throw"pass an array with this format : [{'Name':'ronaldo',...},{'Name':'sarah'}]";e[0]&&(sessionStorage.awesomeTabledata=JSON.stringify(e),h.call(this,e),r.call(this,e.length));break;case"string":/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}}function s(e,t,a){var s=a?function(t){return a(t[e])}:function(t){return t[e]};return t=t?-1:1,function(e,a){return e=s(e),a=s(a),t*((e>a)-(a>e))}}function i(e,t){var a=Math.ceil(e/this.globalOptions.pageSize),s=document.querySelector(".aweTbl-pagination");s&&(s.innerHTML="");var i=s||document.createElement("Div");i.className="aweTbl-pagination";var n={first:{start:null,end:null,showDot:null},middle:{start:null,end:null},last:{start:null,end:null,showDot:null}};if(a>10){3>=t?(n.first.start="1",n.first.end="5",n.last.start=a-1,n.last.end=a,n.last.showDot=!0):4==t?(n.first.start="1",n.first.end="6",n.last.start=a-1,n.last.end=a,n.last.showDot=!0):5==t?(n.first.start="1",n.first.end="7",n.last.start=a-1,n.last.end=a,n.last.showDot=!0):t>5&&a-t>3?(n.first.start="1",n.first.end="2",n.first.showDot=!0,n.middle.start=t-2,n.middle.end=t+2,n.last.start=a-1,n.last.end=a,n.last.showDot=!0):3>=a-t&&(n.first.start="1",n.first.end="2",n.first.showDot=!0,n.last.start=t-5,n.last.end=a);for(var l=n.first.start;l<=n.first.end;l++){var r=p("a",{"class":"aweTbl-pagination-label".concat(l==t?" currentPage ":""),innerHTML:l,href:"javascript:void(0);"});r.addEventListener("click",this.paging.bind(this,l),!1),i.appendChild(r)}if(n.first.showDot){var r=p("a",{"class":"aweTbl-pagination-label",innerHTML:"..",href:"javascript:void(0);"});i.appendChild(r)}if(n.middle.start)for(var l=n.middle.start;l<=n.middle.end;l++){var r=p("a",{"class":"aweTbl-pagination-label".concat(l==t?" currentPage ":""),innerHTML:l,href:"javascript:void(0);"});r.addEventListener("click",this.paging.bind(this,l),!1),i.appendChild(r)}if(n.last.showDot){var r=p("a",{"class":"aweTbl-pagination-label",innerHTML:"..",href:"javascript:void(0);"});i.appendChild(r)}for(var l=n.last.start;l<=n.last.end;l++){var r=p("a",{"class":"aweTbl-pagination-label".concat(l==t?" currentPage ":""),innerHTML:l,href:"javascript:void(0);"});r.addEventListener("click",this.paging.bind(this,l),!1),i.appendChild(r)}}else for(var l=1;a>=l;l++){var r=p("a",{"class":"aweTbl-pagination-label",innerHTML:l,href:"javascript:void(0);"});r.addEventListener("click",this.paging.bind(this,l),!1),i.appendChild(r)}this.paginationWrapper.appendChild(i)}function n(){var e=p(null,{className:"aweTbl-searchBox"}),t=p("input",{type:"text",className:"aweTbl-searchBox-input",placeholder:"write + ENTER"});t.addEventListener("keyup",this.filter.bind(this,t),!1),t.addEventListener("keydown",function(){clearTimeout(this.typingTimer)},!1),e.appendChild(t),this.searchboxWrapper.appendChild(e)}function l(e){if(200!==e.status)throw"i cant use url response as json,check url and make sure that it will respond as json";var t=document.querySelector(".aweTbl-loading");t&&this.tableWrapper.removeChild(t);var a=JSON.parse(e.responseText);if(0==a.Length)throw"There is now recorde ro make a table with";sessionStorage.awesomeTabledata=e.responseText,h.call(this,a),r.call(this,a.length)}function r(e){this.globalOptions.buildPagination&&i.call(this,e,1),this.globalOptions.buildSearch&&n.call(this),this.globalOptions.buildPageSize&&o.call(this)}function o(){var e=document.createElement("select");e.className="aweTbl-pageSize";for(var t=1;5>=t;t++){var a=document.createElement("option");a.innerHTML=15*t,e.appendChild(a)}e.addEventListener("change",this.changePageSize.bind(this,""),!1),this.pageSizeWrapper.appendChild(e)}function p(e,t){var a=document.createElement(e||"div");t=t||{};for(var s in t)t.hasOwnProperty(s)&&("html"==s||"innerHTML"==s?a.innerHTML=t[s]:"tag"!==s&&a.setAttribute(s,t[s]));return a}function d(e){var t=document.createElement("tbody"),a=e.length;if("object"==typeof e[0]){var s=this.jsonKeys.length,i=this.globalOptions.pageSize<a?this.globalOptions.pageSize:a;if(this.globalOptions.columnsTypes)for(var n=0;i>n;n++){var l=document.createElement("tr");for(j=0;j<s;j++){var r=document.createElement("td");if(Object.keys(this.globalOptions.columnsTypes).indexOf(this.jsonKeys[j])>-1)switch(this.globalOptions.columnsTypes[this.jsonKeys[j]]){case"image":var o=p("img",{src:e[n][this.jsonKeys[j]],alt:e[n][this.jsonKeys[j]],className:"aweTbl-img-".concat(this.jsonKeys[j])});r.appendChild(o);break;case"link":var d=p("a",{href:e[n][this.jsonKeys[j]],target:"_blank",className:"aweTbl-link-".concat(this.jsonKeys[j]),innerHTML:e[n][this.jsonKeys[j]]});r.appendChild(d);break;default:r.className="aweTbl-text-".concat(this.jsonKeys[j]),r.innerHTML=e[n][this.jsonKeys[j]]}else r.className="aweTbl-text-".concat(this.jsonKeys[j]),r.innerHTML=e[n][this.jsonKeys[j]];l.appendChild(r)}t.appendChild(l)}else for(var n=0;i>n;n++){var l=document.createElement("tr");for(j=0;j<s;j++){var r=p("td",{className:"aweTbl-text-".concat(this.jsonKeys[j]),innerHTML:e[n][this.jsonKeys[j]]});l.appendChild(r)}t.appendChild(l)}var h=this.tableElement.querySelector("tbody");h&&this.tableElement.removeChild(h),this.tableElement.appendChild(t)}else{var l=document.createElement("tr"),r=p("td",{colSpan:1e3,innerHTML:"Nothing found :("});l.appendChild(r),t.appendChild(l);var h=this.tableElement.querySelector("tbody");h&&this.tableElement.removeChild(h),this.tableElement.appendChild(t)}}function h(e){var t=document.createElement("tbody"),a=e.length;if("object"==typeof e[0]){var s=document.createElement("thead");for(var i in e[0]){var n=document.createElement("th"),l=p("a",{innerHTML:i,href:"javascript:void(0);","data-sortKey":i,"data-sortDirection":"asc"});this.globalOptions.buildSorting&&l.addEventListener("click",this.sort.bind(this,l)),n.appendChild(l),this.jsonKeys.push(i),s.appendChild(n)}var r=this.jsonKeys.length,o=this.globalOptions.pageSize<a?this.globalOptions.pageSize:a;if(this.globalOptions.columnsTypes)for(var d=0;o>d;d++){var h=document.createElement("tr");for(j=0;j<r;j++){var c=document.createElement("td");if(Object.keys(this.globalOptions.columnsTypes).indexOf(this.jsonKeys[j])>-1)switch(this.globalOptions.columnsTypes[this.jsonKeys[j]]){case"image":var b=p("img",{src:e[d][this.jsonKeys[j]],alt:e[d][this.jsonKeys[j]],className:"aweTbl-img-".concat(this.jsonKeys[j])});c.appendChild(b);break;case"link":var g=p("a",{href:e[d][this.jsonKeys[j]],target:"_blank",className:"aweTbl-link-".concat(this.jsonKeys[j]),innerHTML:e[d][this.jsonKeys[j]]});c.appendChild(g);break;default:c.className="aweTbl-text-".concat(this.jsonKeys[j]),c.innerHTML=e[d][this.jsonKeys[j]]}else c.className="aweTbl-text-".concat(this.jsonKeys[j]),c.innerHTML=e[d][this.jsonKeys[j]];h.appendChild(c)}t.appendChild(h)}else for(var d=0;o>d;d++){var h=document.createElement("tr");for(j=0;j<r;j++){var c=p("td",{className:"aweTbl-text-".concat(this.jsonKeys[j]),innerHTML:e[d][this.jsonKeys[j]]});h.appendChild(c)}t.appendChild(h)}var u=this.tableElement.querySelector("tbody");u&&this.tableElement.removeChild(u),this.tableElement.appendChild(s),this.tableElement.appendChild(t)}else console.log("string")}return e.prototype.createTable=function(){if(this.globalOptions.data)a.call(this,this.globalOptions.data);else{if(!this.globalOptions.url)throw"please pass an url ,becuase i want to create table from its json result,or data like an array";var e=this,t=new XMLHttpRequest;console.log(e," self");var s=p(null,{innerHTML:"   Loading Json file with 10000 ...  ",className:"aweTbl-loading"});document.createElement("div"),this.tableWrapper.appendChild(s),t.addEventListener("load",l.bind(e,t)),t.addEventListener("error",function(){throw"requesting that url come with an error \n"+this.responseText}),t.addEventListener("abort",function(){throw"request canceled by you"}),t.open("GET",this.globalOptions.url),t.send()}},e.prototype.paging=function(e){if(e){var t=parseInt(e);console.log(e)}else var t=1;if(sessionStorage.awesomeTabledata||sessionStorage.awesomeTableFiltereddata){var a=JSON.parse(this.isFiltered?sessionStorage.awesomeTableFiltereddata:sessionStorage.awesomeTabledata),s=a.length,n=(t-1)*this.globalOptions.pageSize,l=a.splice(n,this.globalOptions.pageSize);i.call(this,s,t),d.call(this,l)}else this.createTable()},e.prototype.filter=function(e){var a=e.value;if(sessionStorage.awesomeTabledata){var s=JSON.parse(sessionStorage.awesomeTabledata),n=[];console.log(a);for(var l=0,r=s.length;r>l;l++)for(var o=0,p=this.jsonKeys.length;p>o;o++)if(s[l][this.jsonKeys[o]].toString().match(a)){n.push(s[l]);break}this.isFiltered=!0,t(n),d.call(this,n),i.call(this,n.length,1)}else this.isFiltered=!1,this.createTable()},e.prototype.sort=function(e){var t=e.getAttribute("data-sortkey");t=t||this.jsonKeys[0];var a=e.getAttribute("data-sortDirection");if(a=a||"asc",console.log("dirextion : ",a," key : ",t),sessionStorage.awesomeTabledata||sessionStorage.awesomeTableFiltereddata){var i=JSON.parse(this.isFiltered?sessionStorage.awesomeTableFiltereddata:sessionStorage.awesomeTabledata);i.sort(s(t,"asc"==a,null)),this.isFiltered?sessionStorage.awesomeTableFiltereddata=JSON.stringify(i):sessionStorage.awesomeTabledata=JSON.stringify(i),d.call(this,i);for(var n=0,l=this.jsonKeys.length;l>n;n++)e.parentNode.parentNode.childNodes[n].childNodes[0].setAttribute("data-sortDirection","asc");e.setAttribute("data-sortDirection","asc"==a?"desc":"asc")}else this.createTable()},e.prototype.changePageSize=function(e){console.log(e);var t=parseInt(e,10);if(t>0)this.globalOptions.pageSize=t;else{var a=document.querySelector(".aweTbl-pageSize");a?this.globalOptions.pageSize=parseInt(a.value,10):this.globalOptions.pageSize=15}this.paging(1)},e});
