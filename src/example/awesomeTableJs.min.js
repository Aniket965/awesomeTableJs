/*
 awesometablejsv2 2016-06-17 
*/
!function(a,b){"function"==typeof define&&define.amd?define(["awesomeTableJs"],b):a.awesomeTableJs=b(a.awesomeTableJs)}(this,function(){function a(a){this.globalOptions={url:"",data:"",pageSize:15,tableWrapper:"",paginationWrapper:"",searchboxWrapper:"",pageSizeWrapper:"",buildSearch:!0,buildPagination:!0,buildPageSize:!0,buildSorting:!0,columnsTypes:"",updateCallback:null};for(var b in this.globalOptions)a.hasOwnProperty(b)&&(this.globalOptions[b]=a[b]);this.globalOptions.tableWrapper&&(this.tableWrapper=document.querySelector(this.globalOptions.tableWrapper)),this.globalOptions.searchboxWrapper&&(this.searchboxWrapper=document.querySelector(this.globalOptions.searchboxWrapper)),this.globalOptions.paginationWrapper&&(this.paginationWrapper=document.querySelector(this.globalOptions.paginationWrapper)),this.globalOptions.pageSizeWrapper&&(this.pageSizeWrapper=document.querySelector(this.globalOptions.pageSizeWrapper));var c,d;this.tableWrapper?(d=n("table",{"class":"aweTbl-table"}),this.tableElement=d,this.tableWrapper.appendChild(d)):(c=n(null,{"class":"aweTbl-table-wrapper"}),d=n("table",{"class":"aweTbl-table"}),this.tableElement=d,c.appendChild(d),document.body.appendChild(c)),this.paginationWrapper||(c=n(null,{"class":"aweTbl-pagination-wrapper"}),this.paginationWrapper=c,document.body.appendChild(c)),this.pageSizeWrapper||(c=n(null,{"class":"aweTbl-pageCount-wrapper"}),this.pageSizeWrapper=c,document.body.appendChild(c)),this.searchboxWrapper||(c=n(null,{"class":"aweTbl-searchBox-wrapper"}),this.searchboxWrapper=c,document.body.appendChild(c)),this.isFiltered=!1,this.typingCount=null,this.sortingCriteria=[],this.jsonKeys=[]}function b(a){switch(a){case"aweUpdating":this.globalOptions.updateCallback&&this.globalOptions.updateCallback();break;default:this.globalOptions.updateCallback&&this.globalOptions.updateCallback()}}function c(a){console.log(JSON.stringify("start saveing filtered array")),this.typingTimer=setTimeout(function(){sessionStorage.awesomeTableFiltereddata=JSON.stringify(a)},1e3)}function d(a,b,c){for(var d=0,e=a.length;e>d;d++)if(a[d][c]===b)return d;return-1}function e(a,b){var c=d(this.sortingCriteria,a,"key");if(c>-1)"nil"==b||"asc"==b?(this.sortingCriteria.splice(c,1),console.log("delete key ",a," ",b),console.log(this.sortingCriteria)):(console.log("update  key direction ",a," ",b),this.sortingCriteria[c].direction=1);else{var e={key:a,direction:-1};this.sortingCriteria.push(e)}}function f(a){switch(typeof a){case"object":if(!Array.isArray(a))throw"pass an array with this format : [{'Name':'ronaldo',...},{'Name':'sarah'}]";a[0]&&(sessionStorage.awesomeTabledata=JSON.stringify(a),p.call(this,a),l.call(this,a.length));break;case"string":/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}}function g(a){if(!this.sortingCriteria[0])return 0;var b=q(this.sortingCriteria[0].key,{ignoreCase:!0,direction:this.sortingCriteria[0].direction});a.sort(b);for(var c=1;c<this.sortingCriteria.length;c++)a.sort(b.thenBy(this.sortingCriteria[c].key,{ignoreCase:!0,direction:this.sortingCriteria[c].direction}));return a}function h(a,b){var c=Math.ceil(a/this.globalOptions.pageSize),d=document.querySelector(".aweTbl-pagination");d&&(d.innerHTML="");var e=d||document.createElement("Div");e.className="aweTbl-pagination";var f={first:{start:null,end:null,showDot:null},middle:{start:null,end:null},last:{start:null,end:null,showDot:null}};if(c>10){3>=b?(f.first.start="1",f.first.end="5",f.last.start=c-1,f.last.end=c,f.last.showDot=!0):4==b?(f.first.start="1",f.first.end="6",f.last.start=c-1,f.last.end=c,f.last.showDot=!0):5==b?(f.first.start="1",f.first.end="7",f.last.start=c-1,f.last.end=c,f.last.showDot=!0):b>5&&c-b>3?(f.first.start="1",f.first.end="2",f.first.showDot=!0,f.middle.start=b-2,f.middle.end=b+2,f.last.start=c-1,f.last.end=c,f.last.showDot=!0):3>=c-b&&(f.first.start="1",f.first.end="2",f.first.showDot=!0,f.last.start=b-5,f.last.end=c);var g,h=f.first.start;for(h;h<=f.first.end;h++)g=n("a",{"class":"aweTbl-pagination-label".concat(h==b?" currentPage ":""),innerHTML:h,href:"javascript:void(0);"}),g.addEventListener("click",this.paging.bind(this,h),!1),e.appendChild(g);if(f.first.showDot&&(g=n("a",{"class":"aweTbl-pagination-label",innerHTML:"..",href:"javascript:void(0);"}),e.appendChild(g)),f.middle.start)for(h=f.middle.start;h<=f.middle.end;h++)g=n("a",{"class":"aweTbl-pagination-label".concat(h==b?" currentPage ":""),innerHTML:h,href:"javascript:void(0);"}),g.addEventListener("click",this.paging.bind(this,h),!1),e.appendChild(g);for(f.last.showDot&&(g=n("a",{"class":"aweTbl-pagination-label",innerHTML:"..",href:"javascript:void(0);"}),e.appendChild(g)),h=f.last.start;h<=f.last.end;h++)g=n("a",{"class":"aweTbl-pagination-label".concat(h==b?" currentPage ":""),innerHTML:h,href:"javascript:void(0);"}),g.addEventListener("click",this.paging.bind(this,h),!1),e.appendChild(g)}else for(var i=1;c>=i;i++){var j=n("a",{"class":"aweTbl-pagination-label",innerHTML:i,href:"javascript:void(0);"});j.addEventListener("click",this.paging.bind(this,i),!1),e.appendChild(j)}this.paginationWrapper.appendChild(e)}function i(){var a=n(null,{"class":"aweTbl-searchBox"}),b=n("input",{type:"text","class":"aweTbl-searchBox-input",placeholder:"write + ENTER"});b.addEventListener("keyup",this.filter.bind(this,b),!1),b.addEventListener("keydown",function(){clearTimeout(this.typingTimer)},!1),a.appendChild(b),this.searchboxWrapper.appendChild(a)}function k(a){if(200!==a.status)throw"i cant use url response as json,check url and make sure that it will respond as json";var b=document.querySelector(".aweTbl-loading");b&&this.tableWrapper.removeChild(b);var c=JSON.parse(a.responseText);if(0===c.Length)throw"There is now recorde ro make a table with";sessionStorage.awesomeTabledata=a.responseText,p.call(this,c),l.call(this,c.length)}function l(a){this.globalOptions.buildPagination&&h.call(this,a,1),this.globalOptions.buildSearch&&i.call(this),this.globalOptions.buildPageSize&&m.call(this)}function m(){var a=document.createElement("select");a.className="aweTbl-pageSize";for(var b=1;5>=b;b++){var c=document.createElement("option");c.innerHTML=15*b,a.appendChild(c)}a.addEventListener("change",this.changePageSize.bind(this,""),!1),this.pageSizeWrapper.appendChild(a)}function n(a,b){var c=document.createElement(a||"div");b=b||{};for(var d in b)b.hasOwnProperty(d)&&("html"==d||"innerHTML"==d?c.innerHTML=b[d]:"tag"!==d&&c.setAttribute(d,b[d]));return c}function o(a){var b,c,d,e=document.createElement("tbody"),f=a.length;if("object"==typeof a[0]){var g=this.jsonKeys.length,h=this.globalOptions.pageSize<f?this.globalOptions.pageSize:f;if(this.globalOptions.columnsTypes)for(var i=0;h>i;i++){for(b=document.createElement("tr"),j=0;j<g;j++){if(c=document.createElement("td"),Object.keys(this.globalOptions.columnsTypes).indexOf(this.jsonKeys[j])>-1)switch(this.globalOptions.columnsTypes[this.jsonKeys[j]]){case"image":var k=n("img",{src:a[i][this.jsonKeys[j]],alt:a[i][this.jsonKeys[j]],"class":"aweTbl-img-".concat(this.jsonKeys[j])});c.appendChild(k);break;case"link":var l=n("a",{href:a[i][this.jsonKeys[j]],target:"_blank","class":"aweTbl-link-".concat(this.jsonKeys[j]),innerHTML:a[i][this.jsonKeys[j]]});c.appendChild(l);break;default:c.className="aweTbl-text-".concat(this.jsonKeys[j]),c.innerHTML=a[i][this.jsonKeys[j]]}else c.className="aweTbl-text-".concat(this.jsonKeys[j]),c.innerHTML=a[i][this.jsonKeys[j]];b.appendChild(c)}e.appendChild(b)}else for(var m=0;h>m;m++){for(b=document.createElement("tr"),j=0;j<g;j++)c=n("td",{"class":"aweTbl-text-".concat(this.jsonKeys[j]),innerHTML:a[m][this.jsonKeys[j]]}),b.appendChild(c);e.appendChild(b)}d=this.tableElement.querySelector("tbody"),d&&this.tableElement.removeChild(d),this.tableElement.appendChild(e)}else b=document.createElement("tr"),c=n("td",{colSpan:1e3,innerHTML:"Nothing found :("}),b.appendChild(c),e.appendChild(b),d=this.tableElement.querySelector("tbody"),d&&this.tableElement.removeChild(d),this.tableElement.appendChild(e)}function p(a){var b,c,d=document.createElement("tbody"),e=a.length;if("object"==typeof a[0]){var f=document.createElement("thead");for(var g in a[0]){var h=document.createElement("th"),i=n("a",{innerHTML:g,href:"javascript:void(0);","data-sortKey":g,"data-sortDirection":"nil"});this.globalOptions.buildSorting&&i.addEventListener("click",this.sort.bind(this,i)),h.appendChild(i),this.jsonKeys.push(g),f.appendChild(h)}var k=this.jsonKeys.length,l=this.globalOptions.pageSize<e?this.globalOptions.pageSize:e;if(this.globalOptions.columnsTypes)for(var m=0;l>m;m++){for(b=document.createElement("tr"),j=0;j<k;j++){if(c=document.createElement("td"),Object.keys(this.globalOptions.columnsTypes).indexOf(this.jsonKeys[j])>-1)switch(this.globalOptions.columnsTypes[this.jsonKeys[j]]){case"image":var o=n("img",{src:a[m][this.jsonKeys[j]],alt:a[m][this.jsonKeys[j]],"class":"aweTbl-img-".concat(this.jsonKeys[j])});c.appendChild(o);break;case"link":var p=n("a",{href:a[m][this.jsonKeys[j]],target:"_blank","class":"aweTbl-link-".concat(this.jsonKeys[j]),innerHTML:a[m][this.jsonKeys[j]]});c.appendChild(p);break;default:c.className="aweTbl-text-".concat(this.jsonKeys[j]),c.innerHTML=a[m][this.jsonKeys[j]]}else c.className="aweTbl-text-".concat(this.jsonKeys[j]),c.innerHTML=a[m][this.jsonKeys[j]];b.appendChild(c)}d.appendChild(b)}else for(var q=0;l>q;q++){for(b=document.createElement("tr"),j=0;j<k;j++)c=n("td",{"class":"aweTbl-text-".concat(this.jsonKeys[j]),innerHTML:a[q][this.jsonKeys[j]]}),b.appendChild(c);d.appendChild(b)}var r=this.tableElement.querySelector("tbody");r&&this.tableElement.removeChild(r),this.tableElement.appendChild(f),this.tableElement.appendChild(d)}else console.log("string")}a.prototype.createTable=function(){if(this.globalOptions.data)f.call(this,this.globalOptions.data);else{if(!this.globalOptions.url)throw"please pass an url ,becuase i want to create table from its json result,or data like an array";var a=this,b=new XMLHttpRequest;console.log(a," self");var c=n(null,{innerHTML:"   Loading Json file with 10000 ...  ","class":"aweTbl-loading"});document.createElement("div"),this.tableWrapper.appendChild(c),b.addEventListener("load",k.bind(a,b)),b.addEventListener("error",function(){throw"requesting that url come with an error \n"+this.responseText}),b.addEventListener("abort",function(){throw"request canceled by you"}),b.open("GET",this.globalOptions.url),b.send()}},a.prototype.paging=function(a){var c=1;if(a&&(c=parseInt(a)),sessionStorage.awesomeTabledata||sessionStorage.awesomeTableFiltereddata){var d=JSON.parse(this.isFiltered?sessionStorage.awesomeTableFiltereddata:sessionStorage.awesomeTabledata),e=d.length,f=(c-1)*this.globalOptions.pageSize,g=d.splice(f,this.globalOptions.pageSize);h.call(this,e,c),o.call(this,g)}else this.createTable();b.call(this,"")},a.prototype.filter=function(a){var d=a.value;if(sessionStorage.awesomeTabledata){var e=JSON.parse(sessionStorage.awesomeTabledata),f=[];console.log(d);for(var g=0,i=e.length;i>g;g++)for(var j=0,k=this.jsonKeys.length;k>j;j++)if(e[g][this.jsonKeys[j]].toString().match(d)){f.push(e[g]);break}this.isFiltered=!0,c(f),o.call(this,f),h.call(this,f.length,1)}else this.isFiltered=!1,this.createTable();b.call(this,"")};var q=function(){function a(a){return a}function b(a){return"string"==typeof a?a.toLowerCase():a}function c(c,d){if(d="number"==typeof d?{direction:d}:d||{},"function"!=typeof c){var e=c;c=function(a){return a[e]?a[e]:""}}if(1===c.length){var f=c,g=d.ignoreCase?b:a;c=function(a,b){return g(f(a))<g(f(b))?-1:g(f(a))>g(f(b))?1:0}}return-1===d.direction?function(a,b){return-c(a,b)}:c}function d(a,b){return a=c(a,b),a.thenBy=e,a}function e(a,b){var e=this;return a=c(a,b),d(function(b,c){return e(b,c)||a(b,c)})}return d}();return a.prototype.sort=function(a){var c=a.getAttribute("data-sortkey");c=c||this.jsonKeys[0];var d=a.getAttribute("data-sortDirection");if(d=d||"desc",e.call(this,c,d),console.log(this.sortingCriteria),sessionStorage.awesomeTabledata||sessionStorage.awesomeTableFiltereddata){var f=JSON.parse(this.isFiltered?sessionStorage.awesomeTableFiltereddata:sessionStorage.awesomeTabledata);f=g.call(this,f),this.isFiltered?sessionStorage.awesomeTableFiltereddata=JSON.stringify(f):sessionStorage.awesomeTabledata=JSON.stringify(f),o.call(this,f),"nil"==d?a.setAttribute("data-sortDirection","desc"):a.setAttribute("data-sortDirection","desc"==d?"asc":"nil")}else this.createTable();b.call(this,"")},a.prototype.changePageSize=function(a){console.log(a);var c=parseInt(a,10);if(c>0)this.globalOptions.pageSize=c;else{var d=document.querySelector(".aweTbl-pageSize");d?this.globalOptions.pageSize=parseInt(d.value,10):this.globalOptions.pageSize=15}this.paging(1),b.call(this,"")},a});