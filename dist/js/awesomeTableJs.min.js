/*
 awesometablejsv2 2019-05-30 
*/

!function(e,t){"function"==typeof define&&define.amd?define(["awesomeTableJs"],t):e.awesomeTableJs=t(e.awesomeTableJs)}(this,function(){function e(e){for(var t in this.globalOptions={url:"",data:"",pageSize:15,tableWrapper:"",paginationWrapper:"",searchboxWrapper:"",pageSizeWrapper:"",buildSearch:!0,buildPagination:!0,buildPageSize:!0,buildSorting:!0,columnsTypes:"",updateCallback:null},this.globalOptions)e.hasOwnProperty(t)&&(this.globalOptions[t]=e[t]);var a,i;this.globalOptions.tableWrapper&&(this.tableWrapper=document.querySelector(this.globalOptions.tableWrapper)),this.globalOptions.searchboxWrapper&&(this.searchboxWrapper=document.querySelector(this.globalOptions.searchboxWrapper)),this.globalOptions.paginationWrapper&&(this.paginationWrapper=document.querySelector(this.globalOptions.paginationWrapper)),this.globalOptions.pageSizeWrapper&&(this.pageSizeWrapper=document.querySelector(this.globalOptions.pageSizeWrapper)),this.tableWrapper?(i=f("table",{class:"aweTbl-table"}),this.tableElement=i,this.tableWrapper.appendChild(i)):(a=f(null,{class:"aweTbl-table-wrapper"}),i=f("table",{class:"aweTbl-table"}),this.tableElement=i,a.appendChild(i),document.body.appendChild(a)),this.paginationWrapper||(a=f(null,{class:"aweTbl-pagination-wrapper"}),this.paginationWrapper=a,document.body.appendChild(a)),this.pageSizeWrapper||(a=f(null,{class:"aweTbl-pageCount-wrapper"}),this.pageSizeWrapper=a,document.body.appendChild(a)),this.searchboxWrapper||(a=f(null,{class:"aweTbl-searchBox-wrapper"}),this.searchboxWrapper=a,document.body.appendChild(a)),this.isFiltered=!1,this.typingCount=null,this.sortingCriteria=[],this.jsonKeys=[]}function o(e){switch(e){case"aweUpdating":default:this.globalOptions.updateCallback&&this.globalOptions.updateCallback()}}e.prototype.createTable=function(){if(this.globalOptions.data)(function(e){switch(typeof e){case"object":if(!Array.isArray(e))throw"pass an array with this format : [{'Name':'ronaldo',...},{'Name':'sarah'}]";e[0]&&(sessionStorage.awesomeTabledata=JSON.stringify(e),d.call(this,e),i.call(this,e.length));break;case"string":/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}}).call(this,this.globalOptions.data);else{if(!this.globalOptions.url)throw"please pass an url ,becuase i want to create table from its json result,or data like an array";var e=new XMLHttpRequest;console.log(this," self");var t=f(null,{innerHTML:"   Loading Json file with 10000 ...  ",class:"aweTbl-loading"});document.createElement("div"),this.tableWrapper.appendChild(t),e.addEventListener("load",function(e){{if(200!==e.status)throw"i cant use url response as json,check url and make sure that it will respond as json";var t=document.querySelector(".aweTbl-loading");t&&this.tableWrapper.removeChild(t);var a=JSON.parse(e.responseText);if(0===a.Length)throw"There is now recorde ro make a table with";sessionStorage.awesomeTabledata=e.responseText,d.call(this,a),i.call(this,a.length)}}.bind(this,e)),e.addEventListener("error",function(){throw"requesting that url come with an error \n"+this.responseText}),e.addEventListener("abort",function(){throw"request canceled by you"}),e.open("GET",this.globalOptions.url),e.send()}},e.prototype.paging=function(e){var t=1;if(e&&(t=parseInt(e)),sessionStorage.awesomeTabledata||sessionStorage.awesomeTableFiltereddata){var a=JSON.parse(this.isFiltered?sessionStorage.awesomeTableFiltereddata:sessionStorage.awesomeTabledata),i=a.length,s=(t-1)*this.globalOptions.pageSize,n=a.splice(s,this.globalOptions.pageSize);p.call(this,i,t),h.call(this,n)}else this.createTable();o.call(this,"")},e.prototype.filter=function(e){var t=e.value.toLowerCase();if(sessionStorage.awesomeTabledata){var a=JSON.parse(sessionStorage.awesomeTabledata),i=[];console.log(t);for(var s=0,n=a.length;s<n;s++)for(var r=0,l=this.jsonKeys.length;r<l;r++)if(a[s][this.jsonKeys[r]].toString().toLowerCase().match(t)){i.push(a[s]);break}this.isFiltered=!0,function(e){console.log(JSON.stringify("start saveing filtered array")),this.typingTimer=setTimeout(function(){sessionStorage.awesomeTableFiltereddata=JSON.stringify(e)},1e3)}(i),h.call(this,i),p.call(this,i.length,1)}else this.isFiltered=!1,this.createTable();o.call(this,"")};var s=t;function n(e){return e}function r(e){return"string"==typeof e?e.toLowerCase():e}function l(a,e){if(e="number"==typeof e?{direction:e}:e||{},"function"!=typeof a){var t=a;a=function(e){return e[t]?e[t]:""}}if(1===a.length){var i=a,s=e.ignoreCase?r:n;a=function(e,t){return s(i(e))<s(i(t))?-1:s(i(e))>s(i(t))?1:0}}return-1===e.direction?function(e,t){return-a(e,t)}:a}function t(e,t){return(e=l(e,t)).thenBy=a,e}function a(a,e){var i=this;return a=l(a,e),t(function(e,t){return i(e,t)||a(e,t)})}function p(e,t){var a=Math.ceil(e/this.globalOptions.pageSize),i=document.querySelector(".aweTbl-pagination");i&&(i.innerHTML="");var s=i||document.createElement("Div");s.className="aweTbl-pagination";var n={first:{start:null,end:null,showDot:null},middle:{start:null,end:null},last:{start:null,end:null,showDot:null}};if(10<a){var r;t<=3?(n.first.start="1",n.first.end="5",n.last.start=a-1,n.last.end=a,n.last.showDot=!0):4==t?(n.first.start="1",n.first.end="6",n.last.start=a-1,n.last.end=a,n.last.showDot=!0):5==t?(n.first.start="1",n.first.end="7",n.last.start=a-1,n.last.end=a,n.last.showDot=!0):5<t&&3<a-t?(n.first.start="1",n.first.end="2",n.first.showDot=!0,n.middle.start=t-2,n.middle.end=t+2,n.last.start=a-1,n.last.end=a,n.last.showDot=!0):a-t<=3&&(n.first.start="1",n.first.end="2",n.first.showDot=!0,n.last.start=t-5,n.last.end=a);for(var l=n.first.start;l<=n.first.end;l++)(r=f("a",{class:"aweTbl-pagination-label".concat(l==t?" currentPage ":""),innerHTML:l,href:"javascript:void(0);"})).addEventListener("click",this.paging.bind(this,l),!1),s.appendChild(r);if(n.first.showDot&&(r=f("a",{class:"aweTbl-pagination-label",innerHTML:"..",href:"javascript:void(0);"}),s.appendChild(r)),n.middle.start)for(l=n.middle.start;l<=n.middle.end;l++)(r=f("a",{class:"aweTbl-pagination-label".concat(l==t?" currentPage ":""),innerHTML:l,href:"javascript:void(0);"})).addEventListener("click",this.paging.bind(this,l),!1),s.appendChild(r);for(n.last.showDot&&(r=f("a",{class:"aweTbl-pagination-label",innerHTML:"..",href:"javascript:void(0);"}),s.appendChild(r)),l=n.last.start;l<=n.last.end;l++)(r=f("a",{class:"aweTbl-pagination-label".concat(l==t?" currentPage ":""),innerHTML:l,href:"javascript:void(0);"})).addEventListener("click",this.paging.bind(this,l),!1),s.appendChild(r)}else{for(var o=1;o<=a;o++){var p=f("a",{class:"aweTbl-pagination-label",innerHTML:o,href:"javascript:void(0);"});p.addEventListener("click",this.paging.bind(this,o),!1),s.appendChild(p)}}this.paginationWrapper.appendChild(s)}function i(e){this.globalOptions.buildPagination&&p.call(this,e,1),this.globalOptions.buildSearch&&function(){var e=f(null,{class:"aweTbl-searchBox"}),t=f("input",{type:"text",class:"aweTbl-searchBox-input",placeholder:"write + ENTER"});t.addEventListener("keyup",this.filter.bind(this,t),!1),t.addEventListener("keydown",function(){clearTimeout(this.typingTimer)},!1),e.appendChild(t),this.searchboxWrapper.appendChild(e)}.call(this),this.globalOptions.buildPageSize&&function(){var e=document.createElement("select");e.className="aweTbl-pageSize";for(var t=1;t<=5;t++){var a=document.createElement("option");a.innerHTML=15*t,e.appendChild(a)}e.addEventListener("change",this.changePageSize.bind(this,""),!1),this.pageSizeWrapper.appendChild(e)}.call(this)}function f(e,t){var a=document.createElement(e||"div");for(var i in t=t||{})t.hasOwnProperty(i)&&("html"==i||"innerHTML"==i?a.innerHTML=t[i]:"tag"!==i&&a.setAttribute(i,t[i]));return a}function h(e){var t,a,i,s=document.createElement("tbody"),n=e.length;if("object"==typeof e[0]){var r=this.jsonKeys.length,l=this.globalOptions.pageSize<n?this.globalOptions.pageSize:n;if(this.globalOptions.columnsTypes)for(var o=0;o<l;o++){for(t=document.createElement("tr"),j=0;j<r;j++){if(a=document.createElement("td"),-1<Object.keys(this.globalOptions.columnsTypes).indexOf(this.jsonKeys[j]))switch(this.globalOptions.columnsTypes[this.jsonKeys[j]]){case"image":var p=f("img",{src:e[o][this.jsonKeys[j]],alt:e[o][this.jsonKeys[j]],class:"aweTbl-img-".concat(this.jsonKeys[j])});a.appendChild(p);break;case"link":var h=f("a",{href:e[o][this.jsonKeys[j]],target:"_blank",class:"aweTbl-link-".concat(this.jsonKeys[j]),innerHTML:e[o][this.jsonKeys[j]]});a.appendChild(h);break;default:a.className="aweTbl-text-".concat(this.jsonKeys[j]),a.innerHTML=e[o][this.jsonKeys[j]]}else a.className="aweTbl-text-".concat(this.jsonKeys[j]),a.innerHTML=e[o][this.jsonKeys[j]];t.appendChild(a)}s.appendChild(t)}else for(var d=0;d<l;d++){for(t=document.createElement("tr"),j=0;j<r;j++)a=f("td",{class:"aweTbl-text-".concat(this.jsonKeys[j]),innerHTML:e[d][this.jsonKeys[j]]}),t.appendChild(a);s.appendChild(t)}(i=this.tableElement.querySelector("tbody"))&&this.tableElement.removeChild(i),this.tableElement.appendChild(s)}else t=document.createElement("tr"),a=f("td",{colSpan:1e3,innerHTML:"Nothing found :("}),t.appendChild(a),s.appendChild(t),(i=this.tableElement.querySelector("tbody"))&&this.tableElement.removeChild(i),this.tableElement.appendChild(s)}function d(e){var t,a,i=document.createElement("tbody"),s=e.length;if("object"==typeof e[0]){var n=document.createElement("thead");for(var r in e[0]){var l=document.createElement("th"),o=f("a",{innerHTML:r,href:"javascript:void(0);","data-sortKey":r,"data-sortDirection":"nil"});this.globalOptions.buildSorting&&o.addEventListener("click",this.sort.bind(this,o)),l.appendChild(o),this.jsonKeys.push(r),n.appendChild(l)}var p=this.jsonKeys.length,h=this.globalOptions.pageSize<s?this.globalOptions.pageSize:s;if(this.globalOptions.columnsTypes)for(var d=0;d<h;d++){for(t=document.createElement("tr"),j=0;j<p;j++){if(a=document.createElement("td"),-1<Object.keys(this.globalOptions.columnsTypes).indexOf(this.jsonKeys[j]))switch(this.globalOptions.columnsTypes[this.jsonKeys[j]]){case"image":var c=f("img",{src:e[d][this.jsonKeys[j]],alt:e[d][this.jsonKeys[j]],class:"aweTbl-img-".concat(this.jsonKeys[j])});a.appendChild(c);break;case"link":var g=f("a",{href:e[d][this.jsonKeys[j]],target:"_blank",class:"aweTbl-link-".concat(this.jsonKeys[j]),innerHTML:e[d][this.jsonKeys[j]]});a.appendChild(g);break;default:a.className="aweTbl-text-".concat(this.jsonKeys[j]),a.innerHTML=e[d][this.jsonKeys[j]]}else a.className="aweTbl-text-".concat(this.jsonKeys[j]),a.innerHTML=e[d][this.jsonKeys[j]];t.appendChild(a)}i.appendChild(t)}else for(var b=0;b<h;b++){for(t=document.createElement("tr"),j=0;j<p;j++)a=f("td",{class:"aweTbl-text-".concat(this.jsonKeys[j]),innerHTML:e[b][this.jsonKeys[j]]}),t.appendChild(a);i.appendChild(t)}var u=this.tableElement.querySelector("tbody");u&&this.tableElement.removeChild(u),this.tableElement.appendChild(n),this.tableElement.appendChild(i)}else console.log("string")}return e.prototype.sort=function(e){var t=e.getAttribute("data-sortkey");t=t||this.jsonKeys[0];var a=e.getAttribute("data-sortDirection");if(function(e,t){var a=function(e,t,a){for(var i=0,s=e.length;i<s;i++)if(e[i][a]===t)return i;return-1}(this.sortingCriteria,e,"key");if(-1<a)"nil"==t||"asc"==t?(this.sortingCriteria.splice(a,1),console.log("delete key ",e," ",t),console.log(this.sortingCriteria)):(console.log("update  key direction ",e," ",t),this.sortingCriteria[a].direction=1);else{var i={key:e,direction:-1};this.sortingCriteria.push(i)}}.call(this,t,a=a||"desc"),console.log(this.sortingCriteria),sessionStorage.awesomeTabledata||sessionStorage.awesomeTableFiltereddata){var i=JSON.parse(this.isFiltered?sessionStorage.awesomeTableFiltereddata:sessionStorage.awesomeTabledata);i=function(e){if(!this.sortingCriteria[0])return 0;var t=s(this.sortingCriteria[0].key,{ignoreCase:!0,direction:this.sortingCriteria[0].direction});e.sort(t);for(var a=1;a<this.sortingCriteria.length;a++)e.sort(t.thenBy(this.sortingCriteria[a].key,{ignoreCase:!0,direction:this.sortingCriteria[a].direction}));return e}.call(this,i),this.isFiltered?sessionStorage.awesomeTableFiltereddata=JSON.stringify(i):sessionStorage.awesomeTabledata=JSON.stringify(i),h.call(this,i),"nil"==a?e.setAttribute("data-sortDirection","desc"):e.setAttribute("data-sortDirection","desc"==a?"asc":"nil")}else this.createTable();o.call(this,"")},e.prototype.reloadData=function(e){this.globalOptions.data=e,sessionStorage.awesomeTabledata=JSON.stringify(e),h.call(this,e)},e.prototype.changePageSize=function(e){console.log(e);var t=parseInt(e,10);if(0<t)this.globalOptions.pageSize=t;else{var a=document.querySelector(".aweTbl-pageSize");this.globalOptions.pageSize=a?parseInt(a.value,10):15}this.paging(1),o.call(this,"")},e});